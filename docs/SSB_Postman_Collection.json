{
  "info": {
    "name": "Smart School Bus API",
    "description": "Complete API collection for Smart School Bus Tracking System",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:4000", "type": "string" },
    { "key": "api_version", "value": "v1", "type": "string" },
    { "key": "today", "value": "2024-01-01", "type": "string" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "",
                  "if (jsonData.success && jsonData.data && jsonData.data.token) {",
                  "    pm.environment.set(\"token\", jsonData.data.token);",
                  "    console.log(\"Token saved:\", jsonData.data.token);",
                  "} else {",
                  "    console.log(\"Login failed:\", jsonData.message);",
                  "}",
                  "if (jsonData.success && jsonData.data && jsonData.data.refreshToken) {",
                  "    pm.environment.set(\"refreshToken\", jsonData.data.refreshToken);",
                  "    console.log(\"Refresh token saved:\", jsonData.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"quantri@schoolbus.vn\",\n  \"password\": \"password\"\n}"
            },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/auth/login", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "auth", "login"] }
          }
        },
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": { "raw": "{{base_url}}/api/{{api_version}}/auth/profile", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "auth", "profile"] }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.data && jsonData.data.token) {",
                  "  pm.environment.set(\"token\", jsonData.data.token);",
                  "  console.log(\"Access token refreshed\");",
                  "} else {",
                  "  console.log(\"Refresh failed:\", jsonData.message);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}" },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/auth/refresh", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "auth", "refresh"] }
          }
        }
      ]
    },
    {
      "name": "Buses",
      "item": [
        {
          "name": "Get All Buses",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/buses?page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "buses"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" },
                { "key": "search", "value": "", "disabled": true },
                { "key": "status", "value": "hoat_dong", "disabled": true }
              ]
            }
          }
        },
        { "name": "Get Bus by ID", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/buses/1", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses", "1"] } } },
        {
          "name": "Create Bus",
          "request": {
            "method": "POST",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" }, { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"bienSoXe\": \"51B-99999\",\n  \"dongXe\": \"Hyundai Universe\",\n  \"sucChua\": 45,\n  \"trangThai\": \"hoat_dong\"\n}" },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/buses", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses"] }
          }
        },
        {
          "name": "Update Bus",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" }, { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"dongXe\": \"Hyundai Universe - Updated\",\n  \"sucChua\": 50,\n  \"trangThai\": \"bao_tri\"\n}" },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/buses/1", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses", "1"] }
          }
        },
        { "name": "Delete Bus", "request": { "method": "DELETE", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/buses/1", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses", "1"] } } },
        {
          "name": "Assign Driver",
          "request": {
            "method": "POST",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" }, { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"driverId\": 1\n}" },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/buses/1/assign-driver", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses", "1", "assign-driver"] }
          }
        },
        {
          "name": "Update Position",
          "request": {
            "method": "POST",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" }, { "key": "Content-Type", "value": "application/json" } ],
            "body": { "mode": "raw", "raw": "{\n  \"lat\": 21.0285,\n  \"lng\": 105.8542,\n  \"speed\": 45.5,\n  \"heading\": 90,\n  \"timestamp\": \"2025-10-27T10:30:00Z\"\n}" },
            "url": { "raw": "{{base_url}}/api/{{api_version}}/buses/1/position", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "buses", "1", "position"] }
          }
        }
      ]
    },
    {
      "name": "Drivers",
      "item": [
        { "name": "Get All Drivers", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/drivers?page=1&limit=10", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "drivers"], "query": [ { "key": "page", "value": "1" }, { "key": "limit", "value": "10" } ] } } },
        { "name": "Get Driver by ID", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/drivers/2", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "drivers", "2"] } } },
        { "name": "Get Driver Schedules", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/drivers/2/schedules", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "drivers", "2", "schedules"] } } }
      ]
    },
    {
      "name": "Students",
      "item": [
        { "name": "Get All Students", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/students?page=1&limit=10", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "students"], "query": [ { "key": "page", "value": "1" }, { "key": "limit", "value": "10" } ] } } },
        { "name": "Get Student by ID", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/students/1", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "students", "1"] } } },
        { "name": "Get Students Stats", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/students/stats", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "students", "stats"] } } }
      ]
    },
    {
      "name": "Routes & Stops",
      "item": [
        { "name": "Get All Routes", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/routes?page=1&limit=10", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "routes"], "query": [ { "key": "page", "value": "1" }, { "key": "limit", "value": "10" } ] } } },
        { "name": "Get Route by ID", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/routes/1", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "routes", "1"] } } },
        { "name": "Get Route Stops", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "routes", "1", "stops"] } } },
        {
          "name": "Add Stop to Route",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"stop_id\": 1,\n  \"sequence\": 3,\n  \"dwell_seconds\": 30\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "routes", "1", "stops"]
            }
          }
        },
        {
          "name": "Add New Stop to Route",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenDiem\": \"Ngã tư Nguyễn Văn Linh\",\n  \"viDo\": 10.7345,\n  \"kinhDo\": 106.7212,\n  \"address\": \"Ngã tư Nguyễn Văn Linh, Quận 7, TP.HCM\",\n  \"sequence\": 4,\n  \"dwell_seconds\": 30\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "routes", "1", "stops"]
            }
          }
        },
        {
          "name": "Update Stop in Route",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sequence\": 2,\n  \"dwell_seconds\": 45,\n  \"tenDiem\": \"Ngã tư Nguyễn Văn Linh (Updated)\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops/1",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "routes", "1", "stops", "1"]
            }
          }
        },
        {
          "name": "Delete Stop from Route",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops/1",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "routes", "1", "stops", "1"]
            }
          }
        },
        {
          "name": "Reorder Stops",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"stopId\": 1, \"order\": 2 },\n    { \"stopId\": 2, \"order\": 1 },\n    { \"stopId\": 3, \"order\": 3 }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/routes/1/stops/reorder",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "routes", "1", "stops", "reorder"]
            }
          }
        }
      ]
    },
    {
      "name": "Trips (M4-M6)",
      "item": [
        {
          "name": "Get All Trips",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips?page=1&pageSize=10&ngayChay={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "pageSize", "value": "10" },
                { "key": "ngayChay", "value": "{{today}}" },
                { "key": "trangThai", "value": "dang_chay", "disabled": true },
                { "key": "maTuyen", "value": "", "disabled": true },
                { "key": "maXe", "value": "", "disabled": true },
                { "key": "maTaiXe", "value": "", "disabled": true }
              ]
            }
          }
        },
        {
          "name": "Get Trip by ID",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1"]
            }
          }
        },
        {
          "name": "Create Trip",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"maLichTrinh\": 1,\n  \"ngayChay\": \"2025-11-12\",\n  \"trangThai\": \"chua_khoi_hanh\",\n  \"ghiChu\": \"Chuyến đi buổi sáng\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips"]
            }
          }
        },
        {
          "name": "Start Trip",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"gioBatDauThucTe\": \"2025-11-12T06:30:00Z\",\n  \"ghiChu\": \"Bắt đầu chuyến đi\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/start",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "start"]
            }
          }
        },
        {
          "name": "End Trip",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"gioKetThucThucTe\": \"2025-11-12T07:15:00Z\",\n  \"ghiChu\": \"Kết thúc chuyến đi\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/end",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "end"]
            }
          }
        },
        {
          "name": "Cancel Trip",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lyDoHuy\": \"Xe hỏng\",\n  \"ghiChu\": \"Xe bị hỏng động cơ\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/cancel",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "cancel"]
            }
          }
        },
        {
          "name": "Update Trip Position (REST)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lat\": 10.762622,\n  \"lng\": 106.660172,\n  \"speedKph\": 35.5,\n  \"heading\": 180,\n  \"tsClient\": \"2025-11-12T06:35:00Z\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/position",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "position"]
            }
          }
        },
        {
          "name": "Check-in Student",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ghiChu\": \"Học sinh đã lên xe\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/students/5/checkin",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "students", "5", "checkin"]
            }
          }
        },
        {
          "name": "Check-out Student",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ghiChu\": \"Học sinh đã xuống xe\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/trips/1/students/5/checkout",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "trips", "1", "students", "5", "checkout"]
            }
          }
        }
      ]
    },
    {
      "name": "Reports",
      "item": [
        { "name": "Bus Stats", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/reports/buses/stats", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "reports", "buses", "stats"] } } },
        { "name": "Trip Stats (range)", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{base_url}}/api/{{api_version}}/reports/trips/stats?from={{today}}&to={{today}}", "host": ["{{base_url}}"], "path": ["api", "{{api_version}}", "reports", "trips", "stats"], "query": [ { "key": "from", "value": "{{today}}" }, { "key": "to", "value": "{{today}}" } ] } } }
      ]
    },
    {
      "name": "Stats (M7)",
      "item": [
        {
          "name": "Get Stats Overview",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/stats/overview?from={{today}}&to={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "stats", "overview"],
              "query": [
                { "key": "from", "value": "{{today}}" },
                { "key": "to", "value": "{{today}}" },
                { "key": "routeId", "value": "", "disabled": true },
                { "key": "driverId", "value": "", "disabled": true },
                { "key": "busId", "value": "", "disabled": true }
              ]
            }
          }
        },
        {
          "name": "Get Trips by Day",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/stats/trips-by-day?from={{today}}&to={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "stats", "trips-by-day"],
              "query": [
                { "key": "from", "value": "{{today}}" },
                { "key": "to", "value": "{{today}}" }
              ]
            }
          }
        },
        {
          "name": "Get Driver Performance",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/stats/driver-performance?from={{today}}&to={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "stats", "driver-performance"],
              "query": [
                { "key": "from", "value": "{{today}}" },
                { "key": "to", "value": "{{today}}" }
              ]
            }
          }
        },
        {
          "name": "Get Bus Utilization",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/stats/bus-utilization?from={{today}}&to={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "stats", "bus-utilization"],
              "query": [
                { "key": "from", "value": "{{today}}" },
                { "key": "to", "value": "{{today}}" }
              ]
            }
          }
        },
        {
          "name": "Get Route Punctuality",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/stats/route-punctuality?from={{today}}&to={{today}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "stats", "route-punctuality"],
              "query": [
                { "key": "from", "value": "{{today}}" },
                { "key": "to", "value": "{{today}}" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Settings (M8)",
      "item": [
        {
          "name": "Get Settings",
          "request": {
            "method": "GET",
            "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/settings",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "settings"]
            }
          }
        },
        {
          "name": "Update Settings",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"geofenceRadiusMeters\": 80,\n  \"delayThresholdMinutes\": 7,\n  \"realtimeThrottleSeconds\": 3,\n  \"mapsProvider\": \"google\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/settings",
              "host": ["{{base_url}}"],
              "path": ["api", "{{api_version}}", "settings"]
            }
          }
        }
      ]
    },
    {
      "name": "Health Check",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{base_url}}/health", "host": ["{{base_url}}"], "path": ["health"] } }
    }
  ]
}
