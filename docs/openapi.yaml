openapi: 3.0.0
info:
  title: SSB 1.0 API
  version: 1.0.0
  description: Smart School Bus Tracking System API
  contact:
    name: SSB Development Team
    email: dev@ssb.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:4000/api/v1
    description: Development server
  - url: https://api.ssb.com/v1
    description: Production server

security:
  - bearerAuth: []

paths:
  /health:
    get:
      summary: Health check
      description: Check if the API is running
      tags:
        - Health
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "ok"
                      timestamp:
                        type: string
                        format: date-time
                      uptime:
                        type: number
                      environment:
                        type: string
                        example: "development"
                      version:
                        type: string
                        example: "1.0.0"
                      services:
                        type: object
                        properties:
                          database:
                            type: string
                            example: "up"
                          redis:
                            type: string
                            example: "up"
                          socketio:
                            type: string
                            example: "up"

  /auth/login:
    post:
      summary: User login
      description: Authenticate user and return JWT token
      tags:
        - Authentication
      security: []  # No auth required for login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              default:
                value:
                  email: "admin@school.edu.vn"
                  password: "password123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      summary: Refresh access token
      description: Exchange a valid refresh token for a new access token. Send refresh token in Authorization header as Bearer token.
      tags:
        - Authentication
      security: []  # No auth header required; uses refresh token in Authorization header
      parameters:
        - name: Authorization
          in: header
          required: true
          description: Bearer refresh token
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      summary: User registration
      description: Register a new user
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - hoTen
                - email
                - password
                - vaiTro
              properties:
                hoTen:
                  type: string
                  minLength: 2
                  maxLength: 100
                  example: "Nguyễn Văn A"
                email:
                  type: string
                  format: email
                  example: "user@school.edu.vn"
                password:
                  type: string
                  minLength: 6
                  example: "password123"
                soDienThoai:
                  type: string
                  pattern: "^[0-9+\\-\\s()]+$"
                  example: "0901234567"
                vaiTro:
                  type: string
                  enum: [quan_tri, tai_xe, phu_huynh]
                  example: "phu_huynh"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/profile:
    get:
      summary: Get user profile
      description: Get current user's profile information
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /buses:
    get:
      summary: Get all buses
      description: Retrieve a list of all buses with pagination
      tags:
        - Buses
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/Sort'
      responses:
        '200':
          description: Buses retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create a new bus
      description: Create a new bus record
      tags:
        - Buses
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - bienSoXe
                - dongXe
                - sucChua
              properties:
                bienSoXe:
                  type: string
                  minLength: 5
                  maxLength: 15
                  example: "51A-12345"
                dongXe:
                  type: string
                  minLength: 2
                  maxLength: 50
                  example: "Hyundai County"
                sucChua:
                  type: integer
                  minimum: 1
                  maximum: 100
                  example: 30
                trangThai:
                  type: string
                  enum: [hoat_dong, bao_tri, ngung_hoat_dong]
                  default: hoat_dong
      responses:
        '201':
          description: Bus created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Bus'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Bus already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /buses/{id}:
    get:
      summary: Get bus by ID
      description: Retrieve a specific bus by its ID
      tags:
        - Buses
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Bus ID
          schema:
            type: integer
      responses:
        '200':
          description: Bus retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Bus'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Bus not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /buses/{id}/position:
    post:
      summary: Update bus position
      description: Update the GPS position of a bus
      tags:
        - Buses
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Bus ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - lat
                - lng
              properties:
                lat:
                  type: number
                  minimum: -90
                  maximum: 90
                  example: 10.762622
                lng:
                  type: number
                  minimum: -180
                  maximum: 180
                  example: 106.660172
                speed:
                  type: number
                  minimum: 0
                  maximum: 200
                  example: 45.5
                heading:
                  type: number
                  minimum: 0
                  maximum: 360
                  example: 180
      responses:
        '200':
          description: Position updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Position updated"
                      timestamp:
                        type: string
                        format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Bus not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips:
    get:
      summary: Get all trips
      description: Retrieve a list of trips with pagination and filters
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - name: pageSize
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 10
        - name: q
          in: query
          description: Search query
          schema:
            type: string
        - name: ngayChay
          in: query
          description: Trip date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: trangThai
          in: query
          description: Trip status
          schema:
            type: string
            enum: [chua_khoi_hanh, dang_chay, hoan_thanh, huy]
        - name: maTuyen
          in: query
          description: Route ID
          schema:
            type: integer
        - name: maXe
          in: query
          description: Bus ID
          schema:
            type: integer
        - name: maTaiXe
          in: query
          description: Driver ID
          schema:
            type: integer
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            default: ngayChay
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Trips retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Trip'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create a new trip
      description: Create a trip from a schedule (Admin only)
      tags:
        - Trips
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTripRequest'
            example:
              maLichTrinh: 1
              ngayChay: "2025-11-12"
              trangThai: "chua_khoi_hanh"
              ghiChu: "Chuyến đi buổi sáng"
      responses:
        '201':
          description: Trip created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Trip'
                  message:
                    type: string
                    example: "Trip created successfully"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Trip already exists for this schedule and date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}:
    get:
      summary: Get trip by ID
      description: Retrieve detailed information about a specific trip
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
      responses:
        '200':
          description: Trip retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TripDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/start:
    post:
      summary: Start a trip
      description: Start a scheduled trip (Driver only)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                gioBatDauThucTe:
                  type: string
                  format: date-time
                ghiChu:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Trip started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Trip'
        '400':
          description: Invalid trip status or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/end:
    post:
      summary: End a trip
      description: End a running trip (Driver only)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                gioKetThucThucTe:
                  type: string
                  format: date-time
                ghiChu:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Trip ended successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Trip'
        '400':
          description: Invalid trip status or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/cancel:
    post:
      summary: Cancel a trip
      description: Cancel a trip (Admin or Driver of trip)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                lyDoHuy:
                  type: string
                  description: Reason for cancellation
                  maxLength: 500
                ghiChu:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Trip cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Trip'
        '400':
          description: Cannot cancel completed trip or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/position:
    post:
      summary: Update trip position (REST fallback)
      description: Update bus position for a trip (alternative to WebSocket)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TripPositionUpdate'
      responses:
        '200':
          description: Position updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TripPosition'
        '400':
          description: Validation error or rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/students/{studentId}/checkin:
    post:
      summary: Check-in student (onboard)
      description: Mark a student as onboard the bus (Driver only)
      tags:
        - Trips
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
        - name: studentId
          in: path
          required: true
          description: Student ID
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                ghiChu:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Student checked in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/StudentTripStatus'
        '400':
          description: Invalid trip status or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip or student not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /trips/{id}/students/{studentId}/checkout:
    post:
      summary: Check-out student (dropped)
      description: Mark a student as dropped off the bus (Driver only)
      tags:
        - Trips
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID
          schema:
            type: integer
        - name: studentId
          in: path
          required: true
          description: Student ID
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                ghiChu:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Student checked out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/StudentTripStatus'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip or student not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # M7: Stats Endpoints
  /stats/overview:
    get:
      summary: Get overall statistics
      description: M7: Retrieve comprehensive statistics with filters (from/to, routeId, driverId, busId)
      tags:
        - Reports
      security:
        - bearerAuth: []
      parameters:
        - name: from
          in: query
          description: Start date (YYYY-MM-DD), default 7 days ago
          schema:
            type: string
            format: date
            example: "2025-11-04"
        - name: to
          in: query
          description: End date (YYYY-MM-DD), default today
          schema:
            type: string
            format: date
            example: "2025-11-11"
        - name: routeId
          in: query
          description: Filter by route ID
          schema:
            type: integer
            example: 1
        - name: driverId
          in: query
          description: Filter by driver ID
          schema:
            type: integer
            example: 2
        - name: busId
          in: query
          description: Filter by bus ID
          schema:
            type: integer
            example: 3
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/StatsOverview'
                  meta:
                    type: object
                    properties:
                      dateRange:
                        type: object
                        properties:
                          from:
                            type: string
                            format: date
                          to:
                            type: string
                            format: date
                      filters:
                        type: object
        '403':
          description: Forbidden (Parent cannot access stats)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats/trips-by-day:
    get:
      summary: Get daily trip statistics
      description: M7: Retrieve trip statistics grouped by day
      tags:
        - Reports
      security:
        - bearerAuth: []
      parameters:
        - name: from
          in: query
          description: Start date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: End date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: routeId
          in: query
          schema:
            type: integer
        - name: driverId
          in: query
          schema:
            type: integer
        - name: busId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TripsByDay'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats/driver-performance:
    get:
      summary: Get driver performance statistics
      description: M7: Retrieve driver performance metrics
      tags:
        - Reports
      security:
        - bearerAuth: []
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: routeId
          in: query
          schema:
            type: integer
        - name: busId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DriverPerformance'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats/bus-utilization:
    get:
      summary: Get bus utilization statistics
      description: M7: Retrieve bus utilization metrics (Admin only)
      tags:
        - Reports
      security:
        - bearerAuth: []
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: routeId
          in: query
          schema:
            type: integer
        - name: driverId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BusUtilization'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (Admin only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats/route-punctuality:
    get:
      summary: Get route punctuality statistics
      description: M7: Retrieve route punctuality metrics (Admin only)
      tags:
        - Reports
      security:
        - bearerAuth: []
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: driverId
          in: query
          schema:
            type: integer
        - name: busId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RoutePunctuality'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (Admin only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # M8: Settings Endpoints
  /settings:
    get:
      summary: Get system settings
      description: M8: Retrieve current system settings (Admin only)
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SystemSettings'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (Admin only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update system settings
      description: M8: Update system settings with validation (Admin only)
      tags:
        - Admin
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingsRequest'
      responses:
        '200':
          description: Settings updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SystemSettings'
                  meta:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "Cài đặt đã được cập nhật và áp dụng"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (Admin only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reports/buses/stats:
    get:
      summary: Get bus statistics
      description: Retrieve bus performance statistics
      tags:
        - Reports
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/BusStats'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /schedules:
    post:
      summary: Create a new schedule
      description: Create a new schedule with conflict checking
      tags:
        - Schedules
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - maTaiXe
                - maXe
                - gioBatDau
              properties:
                maTaiXe:
                  type: integer
                  example: 1
                maXe:
                  type: integer
                  example: 1
                gioBatDau:
                  type: string
                  format: date-time
                  example: "2024-01-15T06:00:00Z"
                gioKetThuc:
                  type: string
                  format: date-time
                  example: "2024-01-15T18:00:00Z"
                moTa:
                  type: string
                  maxLength: 500
                  example: "Lịch trình buổi sáng"
      responses:
        '201':
          description: Schedule created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Schedule conflict (driver/bus/time)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  code:
                    type: string
                    example: "SCHEDULE_CONFLICT"
                  message:
                    type: string
                    example: "Xung đột lịch trình với xe buýt hoặc tài xế"
                  details:
                    type: object
                    properties:
                      conflicts:
                        type: array
                        items:
                          type: object
                          properties:
                            scheduleId:
                              type: integer
                              example: 5
                            conflictType:
                              type: string
                              enum: [bus, driver, both]
                              example: "both"
                            bus:
                              type: string
                              example: "51A-12345"
                            driver:
                              type: string
                              example: "Trần Văn Tài"
                            time:
                              type: string
                              format: time
                              example: "06:30:00"
                            date:
                              type: string
                              format: date
                              example: "2025-11-11"
                example:
                  success: false
                  code: "SCHEDULE_CONFLICT"
                  message: "Xung đột lịch trình với xe buýt hoặc tài xế"
                  details:
                    conflicts:
                      - scheduleId: 5
                        conflictType: "both"
                        bus: "51A-12345"
                        driver: "Trần Văn Tài"
                        time: "06:30:00"
                        date: "2025-11-11"
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reports/trips/stats:
    get:
      summary: Get trip statistics
      description: Retrieve trip performance statistics
      tags:
        - Reports
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TripStats'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /drivers:
    get:
      summary: Get all drivers
      description: Retrieve a list of all drivers with pagination
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/Sort'
      responses:
        '200':
          description: Drivers retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /students:
    get:
      summary: Get all students
      description: Retrieve a list of all students with pagination
      tags:
        - Students
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/Sort'
      responses:
        '200':
          description: Students retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /routes:
    get:
      summary: Get all routes
      description: Retrieve a list of all routes with pagination
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Search'
        - $ref: '#/components/parameters/Sort'
      responses:
        '200':
          description: Routes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /routes/{id}/stops/reorder:
    patch:
      summary: Reorder stops in route (M1-M3: Atomic transaction)
      description: Sắp xếp lại thứ tự stops trong route. Cập nhật atomic để đảm bảo tính toàn vẹn.
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Route ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
              properties:
                items:
                  type: array
                  description: Mảng {stopId, order} để reorder
                  items:
                    type: object
                    required:
                      - stopId
                      - order
                    properties:
                      stopId:
                        type: integer
                        example: 1
                      order:
                        type: integer
                        minimum: 1
                        example: 2
            example:
              items:
                - stopId: 1
                  order: 2
                - stopId: 2
                  order: 1
      responses:
        '200':
          description: Stops reordered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Stop'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Route not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /routes/{id}/stops:
    get:
      summary: Get route stops
      description: Retrieve all stops for a specific route, sorted by sequence
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Route ID
          schema:
            type: integer
      responses:
        '200':
          description: Route stops retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Route not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Add stop to route
      description: Add a stop to a route (create new stop or use existing stop_id)
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Route ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                stop_id:
                  type: integer
                  description: Existing stop ID (optional if creating new stop)
                sequence:
                  type: integer
                  minimum: 1
                  description: Order in route (auto-assigned if not provided)
                dwell_seconds:
                  type: integer
                  minimum: 0
                  default: 30
                  description: Dwell time in seconds
                tenDiem:
                  type: string
                  minLength: 2
                  maxLength: 255
                  description: Stop name (required if stop_id not provided)
                viDo:
                  type: number
                  format: float
                  minimum: -90
                  maximum: 90
                  description: Latitude (required if stop_id not provided)
                kinhDo:
                  type: number
                  format: float
                  minimum: -180
                  maximum: 180
                  description: Longitude (required if stop_id not provided)
                address:
                  type: string
                  maxLength: 255
                  description: Stop address
                scheduled_time:
                  type: string
                  format: time
                  description: Scheduled arrival time
              oneOf:
                - required: [stop_id]
                - required: [tenDiem, viDo, kinhDo]
            example:
              stop_id: 1
              sequence: 3
              dwell_seconds: 30
      responses:
        '201':
          description: Stop added to route successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Stop already in route or sequence conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Route or stop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /routes/{id}/stops/{stopId}:
    put:
      summary: Update stop in route
      description: Update stop information (sequence, dwell_seconds, or stop details like name/coordinates)
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Route ID
          schema:
            type: integer
        - name: stopId
          in: path
          required: true
          description: Stop ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sequence:
                  type: integer
                  minimum: 1
                  description: New order in route
                dwell_seconds:
                  type: integer
                  minimum: 0
                  description: New dwell time in seconds
                tenDiem:
                  type: string
                  minLength: 2
                  maxLength: 255
                  description: Stop name
                viDo:
                  type: number
                  format: float
                  minimum: -90
                  maximum: 90
                  description: Latitude
                kinhDo:
                  type: number
                  format: float
                  minimum: -180
                  maximum: 180
                  description: Longitude
                address:
                  type: string
                  maxLength: 255
                  description: Stop address
                scheduled_time:
                  type: string
                  format: time
                  description: Scheduled arrival time
            example:
              sequence: 2
              dwell_seconds: 45
              tenDiem: "Ngã tư Nguyễn Văn Linh (Updated)"
      responses:
        '200':
          description: Stop updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Sequence conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Route or stop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Remove stop from route
      description: Remove a stop from a route (does not delete the stop from system)
      tags:
        - Routes
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Route ID
          schema:
            type: integer
        - name: stopId
          in: path
          required: true
          description: Stop ID
          schema:
            type: integer
      responses:
        '200':
          description: Stop removed from route successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeOk'
        '404':
          description: Route or stop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email address
          example: "admin@school.edu.vn"
        password:
          type: string
          minLength: 6
          description: User password
          example: "password123"
        matKhau:
          type: string
          description: Alternative field name for password (for backward compatibility)
          example: "password123"

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            token:
              type: string
              description: JWT access token (expires in 15 minutes)
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            refreshToken:
              type: string
              description: JWT refresh token (expires in 7 days)
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            user:
              $ref: '#/components/schemas/User'
            driverInfo:
              type: object
              nullable: true
              description: Driver information (only present if user role is 'tai_xe')
        message:
          type: string
          example: "Đăng nhập thành công"

    RefreshRequest:
      type: object
      description: Refresh token is sent in Authorization header as Bearer token, not in request body
      properties: {}

    RefreshResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            token:
              type: string
              description: New JWT access token (expires in 15 minutes)
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        message:
          type: string
          example: "Làm mới token thành công"

    ProfileResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            driverInfo:
              type: object
              nullable: true
              description: Driver information (only present if user role is 'tai_xe')
        message:
          type: string
          example: "Lấy thông tin profile thành công"

    User:
      type: object
      properties:
        maNguoiDung:
          type: integer
          description: User ID
          example: 1
        hoTen:
          type: string
          description: Full name
          example: "Nguyễn Văn A"
        email:
          type: string
          format: email
          description: Email address
          example: "admin@school.edu.vn"
        soDienThoai:
          type: string
          nullable: true
          description: Phone number
          example: "0901234567"
        anhDaiDien:
          type: string
          nullable: true
          description: Avatar URL
          example: "https://example.com/avatar.jpg"
        vaiTro:
          type: string
          enum: [quan_tri, tai_xe, phu_huynh]
          description: User role (admin, driver, parent)
          example: "quan_tri"
        trangThai:
          type: boolean
          description: Account status (active/inactive)
          example: true
        ngayTao:
          type: string
          format: date-time
          description: Account creation date
          example: "2025-01-01T00:00:00Z"
        ngayCapNhat:
          type: string
          format: date-time
          description: Last update date
          example: "2025-01-01T00:00:00Z"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    Page:
      name: page
      in: query
      description: Page number
      schema:
        type: integer
        minimum: 1
        default: 1
    Limit:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 20
    Sort:
      name: sort
      in: query
      description: Sort order
      schema:
        type: string
        example: "updatedAt:desc"
    Search:
      name: search
      in: query
      description: Search term
      schema:
        type: string

  schemas:
    EnvelopeOk:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data: {}
        meta:
          type: object
          additionalProperties: true
    User:
      type: object
      properties:
        maNguoiDung:
          type: integer
          example: 1
        hoTen:
          type: string
          example: "Nguyễn Văn A"
        email:
          type: string
          format: email
          example: "admin@school.edu.vn"
        soDienThoai:
          type: string
          example: "0901234567"
        anhDaiDien:
          type: string
          example: "https://example.com/avatar.jpg"
        vaiTro:
          type: string
          enum: [quan_tri, tai_xe, phu_huynh]
          example: "quan_tri"
        trangThai:
          type: boolean
          example: true
        ngayTao:
          type: string
          format: date-time
        ngayCapNhat:
          type: string
          format: date-time

    Bus:
      type: object
      properties:
        maXe:
          type: integer
          example: 1
        bienSoXe:
          type: string
          example: "51A-12345"
        dongXe:
          type: string
          example: "Hyundai County"
        sucChua:
          type: integer
          example: 30
        trangThai:
          type: string
          enum: [hoat_dong, bao_tri, ngung_hoat_dong]
          example: "hoat_dong"
        ngayTao:
          type: string
          format: date-time
        position:
          type: object
          properties:
            lat:
              type: number
              example: 10.762622
            lng:
              type: number
              example: 106.660172
            speed:
              type: number
              example: 45.5
            heading:
              type: number
              example: 180
            timestamp:
              type: string
              format: date-time

    BusStats:
      type: object
      properties:
        totalBuses:
          type: integer
          example: 10
        activeBuses:
          type: integer
          example: 8
        maintenanceBuses:
          type: integer
          example: 2
        averageUtilization:
          type: number
          example: 85.5
        totalTrips:
          type: integer
          example: 150
        completedTrips:
          type: integer
          example: 145
        delayedTrips:
          type: integer
          example: 5

    TripStats:
      type: object
      properties:
        totalTrips:
          type: integer
          example: 150
        completedTrips:
          type: integer
          example: 145
        cancelledTrips:
          type: integer
          example: 3
        delayedTrips:
          type: integer
          example: 5
        averageDuration:
          type: number
          example: 45.5
        onTimePercentage:
          type: number
          example: 96.7

    PaginationMeta:
      type: object
      description: M1-M3: Standardized pagination metadata
      properties:
        page:
          type: integer
          minimum: 1
          example: 1
        pageSize:
          type: integer
          minimum: 1
          maximum: 200
          example: 10
        total:
          type: integer
          example: 100
        totalPages:
          type: integer
          example: 10
        sortBy:
          type: string
          example: "maXe"
        sortOrder:
          type: string
          enum: [asc, desc]
          example: "desc"
        q:
          type: string
          nullable: true
          description: Search query
          example: "search term"
        hasNext:
          type: boolean
          example: true
        hasPrev:
          type: boolean
          example: false

    # M4-M6: Trip Lifecycle Schemas
    CreateTripRequest:
      type: object
      required:
        - maLichTrinh
        - ngayChay
      properties:
        maLichTrinh:
          type: integer
          description: Schedule ID
          example: 1
        ngayChay:
          type: string
          format: date
          description: Trip date (YYYY-MM-DD)
          example: "2025-11-12"
        trangThai:
          type: string
          enum: [chua_khoi_hanh, dang_chay, hoan_thanh, huy]
          default: chua_khoi_hanh
          description: Initial trip status
          example: "chua_khoi_hanh"
        ghiChu:
          type: string
          maxLength: 500
          nullable: true
          description: Notes
          example: "Chuyến đi buổi sáng"

    Trip:
      type: object
      description: M4-M6: Trip entity
      properties:
        maChuyen:
          type: integer
          description: Trip ID
          example: 1
        maLichTrinh:
          type: integer
          description: Schedule ID
          example: 1
        ngayChay:
          type: string
          format: date
          description: Trip date
          example: "2025-11-12"
        trangThai:
          type: string
          enum: [chua_khoi_hanh, dang_chay, hoan_thanh, huy]
          description: Trip status (planned/started/completed/canceled)
          example: "dang_chay"
        gioBatDauThucTe:
          type: string
          format: date-time
          nullable: true
          description: Actual start time
          example: "2025-11-12T06:30:00Z"
        gioKetThucThucTe:
          type: string
          format: date-time
          nullable: true
          description: Actual end time
          example: "2025-11-12T07:15:00Z"
        ghiChu:
          type: string
          nullable: true
          description: Notes
        # Additional fields from joins
        tenTuyen:
          type: string
          nullable: true
          description: Route name
        bienSoXe:
          type: string
          nullable: true
          description: Bus plate number
        tenTaiXe:
          type: string
          nullable: true
          description: Driver name

    TripDetail:
      allOf:
        - $ref: '#/components/schemas/Trip'
        - type: object
          properties:
            schedule:
              type: object
              nullable: true
              description: Schedule details
            busInfo:
              $ref: '#/components/schemas/Bus'
            driverInfo:
              type: object
              nullable: true
              description: Driver information
            routeInfo:
              type: object
              nullable: true
              description: Route information
            students:
              type: array
              items:
                $ref: '#/components/schemas/StudentTripStatus'
              description: List of students on trip

    TripPosition:
      type: object
      description: M4-M6: Bus position for a trip
      properties:
        tripId:
          type: integer
          example: 1
        busId:
          type: integer
          example: 5
        lat:
          type: number
          format: float
          description: Latitude
          example: 10.762622
        lng:
          type: number
          format: float
          description: Longitude
          example: 106.660172
        speedKph:
          type: number
          format: float
          nullable: true
          description: Speed in km/h
          example: 35.5
        heading:
          type: number
          format: float
          nullable: true
          description: Heading in degrees (0-360)
          example: 180
        timestamp:
          type: string
          format: date-time
          description: Position timestamp
          example: "2025-11-12T06:35:00Z"

    TripPositionUpdate:
      type: object
      required:
        - lat
        - lng
      properties:
        lat:
          type: number
          format: float
          description: Latitude
          example: 10.762622
        lng:
          type: number
          format: float
          description: Longitude
          example: 106.660172
        speedKph:
          type: number
          format: float
          nullable: true
          description: Speed in km/h
          example: 35.5
        heading:
          type: number
          format: float
          nullable: true
          description: Heading in degrees (0-360)
          example: 180
        tsClient:
          type: string
          format: date-time
          nullable: true
          description: Client timestamp
          example: "2025-11-12T06:35:00Z"

    TripEvent:
      type: object
      description: M4-M6: Trip event log
      properties:
        eventId:
          type: integer
          example: 1
        tripId:
          type: integer
          example: 1
        eventType:
          type: string
          enum: [approach_stop, delay_alert, pickup_status_update, trip_started, trip_completed, trip_cancelled]
          description: Event type
          example: "approach_stop"
        payload:
          type: object
          description: Event payload (varies by type)
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
          example: "2025-11-12T06:35:00Z"

    StudentTripStatus:
      type: object
      description: M4-M6: Student status in a trip
      properties:
        maTrangThai:
          type: integer
          example: 1
        maChuyen:
          type: integer
          example: 1
        maHocSinh:
          type: integer
          example: 5
        thuTuDiemDon:
          type: integer
          nullable: true
          description: Pickup stop order
          example: 1
        trangThai:
          type: string
          enum: [cho_don, da_don, da_tra, vang]
          description: Status (waiting/onboard/dropped/absent)
          example: "da_don"
        thoiGianThucTe:
          type: string
          format: date-time
          nullable: true
          description: Actual time
          example: "2025-11-12T06:35:00Z"
        ghiChu:
          type: string
          nullable: true
        # Additional fields
        studentName:
          type: string
          nullable: true
          description: Student name
          example: "Nguyễn Văn A"
        status:
          type: string
          enum: [onboard, dropped]
          nullable: true
          description: M4-M6: Standardized status (onboard=da_don, dropped=da_tra)
          example: "onboard"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        code:
          type: string
          example: "VALIDATION_422"
        message:
          type: string
          example: "Validation error"
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: "email"
              message:
                type: string
                example: "Email is required"
              value:
                type: string
                example: ""
        timestamp:
          type: string
          format: date-time
        path:
          type: string
          example: "/api/v1/buses"

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: User authentication and authorization
  - name: Buses
    description: Bus management operations
  - name: Drivers
    description: Driver management operations
  - name: Routes
    description: Route management operations
  - name: Schedules
    description: Schedule management operations
  - name: Trips
    description: Trip execution and tracking
  - name: Students
    description: Student management operations
  - name: Parents
    description: Parent management operations
  - name: Notifications
    description: Notification management
  - name: Reports
    description: Reporting and analytics
  - name: Stats
    description: M7: Statistics and analytics endpoints
  - name: Admin
    description: Administrative operations
  - name: Settings
    description: M8: System settings and configuration