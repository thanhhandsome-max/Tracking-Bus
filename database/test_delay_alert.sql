-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ§ª TEST DELAY ALERT - Xe cháº¡y trá»… >5 phÃºt
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 
-- HÆ¯á»šNG DáºªN:
-- 1. Cháº¡y script nÃ y trong MySQL/phpMyAdmin
-- 2. Script sáº½ update giá» khá»Ÿi hÃ nh cá»§a Trip 22 thÃ nh 10 phÃºt trÆ°á»›c giá» hiá»‡n táº¡i
-- 3. Khi GPS gá»­i, backend sáº½ phÃ¡t hiá»‡n xe trá»… >5 phÃºt vÃ  emit delay_alert
-- 
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USE school_bus_system;

-- Láº¥y thÃ´ng tin trip hiá»‡n táº¡i
SELECT 
  cd.maChuyen,
  cd.ngayChay,
  lt.gioKhoiHanh as 'Giá» khá»Ÿi hÃ nh (lá»‹ch)',
  cd.gioBatDauThucTe as 'Giá» báº¯t Ä‘áº§u thá»±c táº¿',
  cd.trangThai,
  TIMESTAMPDIFF(MINUTE, 
    TIMESTAMP(cd.ngayChay, lt.gioKhoiHanh), 
    NOW()
  ) as 'Sá»‘ phÃºt trá»…'
FROM ChuyenDi cd
JOIN LichTrinh lt ON cd.maLichTrinh = lt.maLichTrinh
WHERE cd.maChuyen = 22;

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- ğŸ”§ UPDATE: Äáº·t giá» khá»Ÿi hÃ nh = 10 phÃºt trÆ°á»›c Ä‘á»ƒ giáº£ láº­p xe trá»…
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- CÃ¡ch 1: Update LichTrinh (giá» khá»Ÿi hÃ nh trong schedule)
-- Äáº·t gioKhoiHanh = giá» hiá»‡n táº¡i - 10 phÃºt
UPDATE LichTrinh 
SET gioKhoiHanh = TIME(DATE_SUB(NOW(), INTERVAL 10 MINUTE))
WHERE maLichTrinh = 1;

-- CÃ¡ch 2: Hoáº·c set giá» cá»¥ thá»ƒ (náº¿u báº¡n biáº¿t giá» hiá»‡n táº¡i)
-- UPDATE LichTrinh 
-- SET gioKhoiHanh = '10:10:00'  -- Thay báº±ng giá» hiá»‡n táº¡i - 10 phÃºt
-- WHERE maLichTrinh = 1;

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- âœ… KIá»‚M TRA Káº¾T QUáº¢
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SELECT 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' as '';
SELECT 'âœ… ÄÃƒ UPDATE XONG! BÃ¢y giá» xe Ä‘ang trá»… >5 phÃºt' as 'Káº¿t quáº£';
SELECT 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•' as '';

-- Hiá»ƒn thá»‹ thÃ´ng tin sau khi update
SELECT 
  cd.maChuyen as 'Trip ID',
  lt.gioKhoiHanh as 'Giá» khá»Ÿi hÃ nh',
  NOW() as 'Giá» hiá»‡n táº¡i',
  TIMESTAMPDIFF(MINUTE, 
    TIMESTAMP(cd.ngayChay, lt.gioKhoiHanh), 
    NOW()
  ) as 'Sá»‘ phÃºt trá»…',
  CASE 
    WHEN TIMESTAMPDIFF(MINUTE, TIMESTAMP(cd.ngayChay, lt.gioKhoiHanh), NOW()) > 5 
    THEN 'â° CÃ“ - Sáº½ trigger delay_alert'
    ELSE 'âŒ KHÃ”NG - ChÆ°a Ä‘á»§ 5 phÃºt'
  END as 'Delay Alert?'
FROM ChuyenDi cd
JOIN LichTrinh lt ON cd.maLichTrinh = lt.maLichTrinh
WHERE cd.maChuyen = 22;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“‹ CÃCH TEST:
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 
-- 1. âœ… Cháº¡y script nÃ y trong MySQL
-- 2. âœ… Quay láº¡i Driver page (Ä‘ang cháº¡y trip 22)
-- 3. âœ… GPS sáº½ gá»­i vá»‹ trÃ­ sau 3 giÃ¢y
-- 4. âœ… Backend sáº½ phÃ¡t hiá»‡n delay vÃ  log:
--       â° [DELAY] Trip 22 delayed by X minutes
--       ğŸ“¡ emit: delay_alert to trip-22
-- 5. âœ… Check backend log Ä‘á»ƒ xÃ¡c nháº­n
-- 
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ”™ RESET Vá»€ BAN Äáº¦U (sau khi test xong):
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 
-- UPDATE LichTrinh 
-- SET gioKhoiHanh = '06:30:00'
-- WHERE maLichTrinh = 1;
-- 
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
